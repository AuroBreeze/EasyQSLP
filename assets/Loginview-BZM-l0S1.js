import{d as B,r as c,w as M,c as C,F as Q,e as s,f as U,g as f,v as w,t as I,o as h,h as L,a as _,i as $,j as N,u as z,k as H}from"./index-DoHoPr3b.js";import{_ as A,W as K}from"./WaveBackground-CVepOhwB.js";const X={style:{display:"flex","align-items":"center",gap:"10px"}},Y={class:"input-group",style:{"flex-grow":"1"}},Z=["placeholder","id"],ee=["for"],se=["id","disabled"],oe={key:0,class:"error-message"},te=B({__name:"EmailCode",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"邮箱"},label:{type:String,default:"邮箱"},inputId:{type:String,default:"emailInput"},buttonId:{type:String,default:"getCodeBtn"},buttonText:{type:String,default:"获取验证码"},usage:{type:String,required:!0}},emits:["update:modelValue","codeSent"],setup(m,{expose:P,emit:l}){const v=m,y=l,p=c(v.modelValue);M(p,r=>{y("update:modelValue",r)}),M(()=>v.modelValue,r=>{p.value=r});const u=c(""),d=c(0),S=c(!0),E=()=>{u.value=""},T=r=>{u.value=r,setTimeout(()=>{u.value=""},5e3)},x=async()=>{if(S.value){if(!p.value){T("请输入邮箱地址");return}try{const a=await(await fetch("http://localhost:8000/api/v1/user/emailsendcode/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:p.value,usage:v.usage})})).json();if(a.success){S.value=!1,d.value=60;const b=setInterval(()=>{d.value--,d.value<=0&&(clearInterval(b),S.value=!0)},1e3);y("codeSent",!0)}else T(a.message),y("codeSent",!1)}catch(r){console.error("验证码请求失败:",r),T("验证码请求失败，请检查网络连接"),y("codeSent",!1)}}};return P({email:p,clearError:E}),(r,a)=>(h(),C(Q,null,[s("div",X,[s("div",Y,[f(s("input",{type:"email",placeholder:m.placeholder,id:m.inputId,"onUpdate:modelValue":a[0]||(a[0]=b=>p.value=b),onInput:E},null,40,Z),[[w,p.value]]),s("label",{for:m.inputId},I(m.label),9,ee)]),s("button",{type:"button",id:m.buttonId,onClick:x,disabled:!S.value},I(S.value?m.buttonText:`${d.value}秒后重试`),9,se)]),u.value?(h(),C("div",oe,I(u.value),1)):U("",!0)],64))}}),D=A(te,[["__scopeId","data-v-e42c5187"]]),ne={class:"page-container"},re={class:"content-wrapper"},ae={class:"container",id:"container"},le={class:"form-container sign-up-container"},ie={key:0,class:"error-message"},de={class:"input-group"},ue={class:"input-group"},pe={class:"input-group"},ce={class:"form-container sign-in-container"},me={key:0,class:"error-message"},ve={class:"input-group"},ge={class:"input-group"},fe={class:"form-container forgot-password-container"},we={key:0,class:"error-message"},ye={class:"input-group"},Se={class:"input-group"},be={class:"input-group"},ke={class:"overlay-container"},he={class:"overlay"},Ve={class:"overlay-panel overlay-left"},Ce={class:"overlay-panel overlay-right"},Ie={key:0,class:"success-page"},Ee={class:"success-container"},Pe={class:"success-content"},Te={class:"countdown"},$e=B({__name:"Sign",setup(m){const P=z(),l=L({name:"",email:"",code:"",password:""}),v=L({email:"",password:""}),y=c(!1),p=c(3),u=c(""),d=c(""),S=t=>{t||g("验证码发送失败")},E=t=>{const e=document.getElementById("container");e&&(b.value&&t&&(e.classList.remove("forgot-panel-active"),b.value=!1),t?e.classList.add("right-panel-active"):e.classList.remove("right-panel-active"),d.value="",u.value="")},T=async()=>{const{email:t,password:e}=v;if(!t||!e){k("邮箱和密码不能为空");return}if(new URLSearchParams(window.location.search).get("mock")==="true"){console.log("Running in mock mode - simulating successful login"),y.value=!0,localStorage.setItem("user_id","mock-user-123"),R();return}try{const i=await fetch("http://localhost:8000/api/v1/user/login/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:t,password:e})}),o=await i.json();if(!i.ok){o.errors?o.errors.ValidationError?k(o.errors.ValidationError):o.errors.email?k(`邮箱错误: ${o.errors.email}`):o.errors.password?k(`密码错误: ${o.errors.password}`):k(o.message||"登录失败"):k(o.message||"登录失败");return}if(o.success){const j=await(await fetch("http://localhost:8000/api/v1/user/token/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:t,password:e})})).json();j.access?(localStorage.setItem("access_token",j.access),localStorage.setItem("refresh_token",j.refresh),localStorage.setItem("user_id",o.user_id),localStorage.setItem("username",o.username),y.value=!0,R()):k(j.detail||"获取token失败")}}catch(i){console.error("登录请求失败:",i),k("网络错误，请检查连接后重试")}},x=async()=>{const{name:t,email:e,code:n,password:V}=l;if(!t||!e||!n||!V){g("请填写所有必填项");return}try{const i=await fetch("http://localhost:8000/api/v1/user/register/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e,password:V,username:t,code:n,usage:"Register"})}),o=await i.json();if(console.log(o),!i.ok){o.errors?o.errors.ValidationError?g(o.errors.ValidationError[0]):o.errors.email?g(`邮箱错误: ${o.errors.email}`):o.errors.password?g(`密码错误: ${o.errors.password}`):o.errors.code?g(`验证码错误: ${o.errors.code}`):g(o.message||"注册失败"):g(o.message||"注册失败");return}o.success&&(d.value="注册成功，正在跳转到登录页面...",setTimeout(()=>{E(!1),l.name="",l.email="",l.code="",l.password="",d.value="注册成功，请登录"},2e3))}catch(i){console.error("注册请求失败:",i),g("网络错误，请检查连接后重试")}},r=L({email:"",code:"",password:"",password_confirm:""}),a=c(""),b=c(!1),J=()=>{const t=document.getElementById("container");t&&(t.classList.remove("right-panel-active"),t.classList.add("forgot-panel-active"),b.value=!0,u.value="",d.value="")},O=()=>{const t=document.getElementById("container");t&&(t.classList.remove("forgot-panel-active"),b.value=!1,r.email="",r.code="",r.password="",r.password_confirm="",a.value="")},F=async()=>{const{email:t,code:e,password:n,password_confirm:V}=r;if(!t||!e||!n||!V){a.value="请填写所有必填项";return}if(n!==V){a.value="两次输入的密码不一致";return}try{const i=await fetch("http://localhost:8000/api/v1/user/resetpassword/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:t,code:e,password:n,password_confirm:V})}),o=await i.json();if(!i.ok){o.errors?o.errors.ValidationError?a.value=o.errors.ValidationError[0]:o.errors.email?a.value=`邮箱错误: ${o.errors.email}`:o.errors.code?a.value=`验证码错误: ${o.errors.code}`:o.errors.password?a.value=`密码错误: ${o.errors.password}`:a.value=o.message||"密码重置失败":a.value=o.message||"密码重置失败";return}o.success&&(a.value="",G("密码重置成功！2秒后将自动返回登录页面"),setTimeout(()=>{O(),r.email="",r.code="",r.password="",r.password_confirm=""},2e3))}catch(i){console.error("密码重置请求失败:",i),a.value="网络错误，请检查连接后重试"}},k=t=>{u.value=t,setTimeout(()=>{u.value=""},5e3)},G=t=>{a.value=t;const e=document.querySelector(".forgot-password-container .error-message");e&&e.classList.add("success-message"),setTimeout(()=>{a.value="",e&&e.classList.remove("success-message")},5e3)},g=t=>{d.value=t,setTimeout(()=>{d.value=""},5e3)},R=()=>{const t=setInterval(()=>{p.value--,p.value<=0&&(clearInterval(t),P.push("/start/"))},1e3)},q=()=>{P.push("/support")};return(t,e)=>(h(),C("div",ne,[_(K),s("div",re,[e[37]||(e[37]=s("h2",null,"欢迎来到EasyQSLP",-1)),s("div",ae,[s("div",le,[s("form",{onSubmit:$(x,["prevent"])},[e[15]||(e[15]=s("h1",null,"创建账户😀",-1)),e[16]||(e[16]=s("span",null,"使用邮箱注册",-1)),d.value?(h(),C("div",ie,I(d.value),1)):U("",!0),s("div",de,[f(s("input",{type:"text",placeholder:"姓名",id:"nameInput","onUpdate:modelValue":e[0]||(e[0]=n=>l.name=n)},null,512),[[w,l.name]]),e[12]||(e[12]=s("label",{for:"nameInput"},"姓名",-1))]),_(D,{modelValue:l.email,"onUpdate:modelValue":e[1]||(e[1]=n=>l.email=n),"input-id":"signupEmail","button-id":"signupGetCode",usage:"Register",onCodeSent:S},null,8,["modelValue"]),s("div",ue,[f(s("input",{type:"text",placeholder:"验证码",id:"signupCode","onUpdate:modelValue":e[2]||(e[2]=n=>l.code=n)},null,512),[[w,l.code]]),e[13]||(e[13]=s("label",{for:"signupCode"},"验证码",-1))]),s("div",pe,[f(s("input",{type:"password",placeholder:"密码",id:"signupPassword","onUpdate:modelValue":e[3]||(e[3]=n=>l.password=n)},null,512),[[w,l.password]]),e[14]||(e[14]=s("label",{for:"signupPassword"},"密码",-1))]),e[17]||(e[17]=s("button",null,"注册",-1))],32)]),s("div",ce,[s("form",{onSubmit:$(T,["prevent"])},[e[20]||(e[20]=s("h1",null,"登录😃",-1)),e[21]||(e[21]=s("span",null,"账户密码登录",-1)),u.value?(h(),C("div",me,I(u.value),1)):U("",!0),s("div",ve,[f(s("input",{type:"email",placeholder:"邮箱",id:"signinEmail","onUpdate:modelValue":e[4]||(e[4]=n=>v.email=n)},null,512),[[w,v.email]]),e[18]||(e[18]=s("label",{for:"signinEmail"},"邮箱",-1))]),s("div",ge,[f(s("input",{type:"password",placeholder:"密码",id:"signinPassword","onUpdate:modelValue":e[5]||(e[5]=n=>v.password=n)},null,512),[[w,v.password]]),e[19]||(e[19]=s("label",{for:"signinPassword"},"密码",-1))]),s("a",{href:"#",class:"forgot-password",onClick:$(J,["prevent"])},"忘记密码?"),e[22]||(e[22]=s("button",null,"登录",-1))],32)]),s("div",fe,[s("form",{onSubmit:$(F,["prevent"])},[e[26]||(e[26]=s("h1",null,"重置密码",-1)),e[27]||(e[27]=s("span",null,"请输入您的邮箱和验证码",-1)),a.value?(h(),C("div",we,I(a.value),1)):U("",!0),_(D,{modelValue:r.email,"onUpdate:modelValue":e[6]||(e[6]=n=>r.email=n),"input-id":"forgotEmail","button-id":"forgotGetCode",usage:"ResetPassword",onCodeSent:S},null,8,["modelValue"]),s("div",ye,[f(s("input",{type:"text",placeholder:"验证码",id:"forgotCode","onUpdate:modelValue":e[7]||(e[7]=n=>r.code=n)},null,512),[[w,r.code]]),e[23]||(e[23]=s("label",{for:"forgotCode"},"验证码",-1))]),s("div",Se,[f(s("input",{type:"password",placeholder:"新密码",id:"newPassword","onUpdate:modelValue":e[8]||(e[8]=n=>r.password=n)},null,512),[[w,r.password]]),e[24]||(e[24]=s("label",{for:"newPassword"},"新密码",-1))]),s("div",be,[f(s("input",{type:"password",placeholder:"确认新密码",id:"confirmPassword","onUpdate:modelValue":e[9]||(e[9]=n=>r.password_confirm=n)},null,512),[[w,r.password_confirm]]),e[25]||(e[25]=s("label",{for:"confirmPassword"},"确认新密码",-1))]),e[28]||(e[28]=s("button",{type:"submit"},"重置密码",-1)),s("a",{href:"#",class:"back-to-login",onClick:$(O,["prevent"])},"返回登录")],32)]),s("div",ke,[s("div",he,[s("div",Ve,[e[29]||(e[29]=s("h1",null,"欢迎回来！😊",-1)),e[30]||(e[30]=s("p",null,"请使用您的个人信息登录以保持与我们的联系",-1)),s("button",{class:"ghost",id:"signIn",onClick:e[10]||(e[10]=n=>E(!1))},"登录")]),s("div",Ce,[e[31]||(e[31]=s("h1",null,"欢迎🎉",-1)),e[32]||(e[32]=s("p",null,"注册账户，并加入我们的大家庭",-1)),s("button",{class:"ghost",id:"signUp",onClick:e[11]||(e[11]=n=>E(!0))},"注册")])])])]),y.value?(h(),C("div",Ie,[s("div",Ee,[s("div",Pe,[e[35]||(e[35]=s("h1",null,"登录成功🎉",-1)),e[36]||(e[36]=s("p",null,"您已成功登录，欢迎回来！",-1)),s("p",null,[e[33]||(e[33]=N("页面将在 ")),s("span",Te,I(p.value),1),e[34]||(e[34]=N(" 秒后自动跳转..."))]),s("button",{class:"success-button",onClick:q},"联系支持")])])])):U("",!0)])]))}}),Ue=A($e,[["__scopeId","data-v-3d21bf10"]]),Le=B({__name:"Loginview",setup(m){return(P,l)=>(h(),H(Ue))}});export{Le as default};
